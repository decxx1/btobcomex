---
const currentPath = Astro.url.pathname;

const isActive = (path: string) => {
	if (path === '/') return currentPath === '/';
	return currentPath.startsWith(path);
};
---

<header id="main-header" class="fixed top-0 z-50 w-full transition-colors duration-300">
	<section
		class="container mx-auto py-6 px-4 lg:px-6 xl:px-12 flex justify-between items-center text-white"
	>
		<a href="/" class="flex items-center gap-2">
			<img
				src="/assets/logos/logo-color.svg"
				alt="B TO B Comex"
				class="h-12 lg:h-12 xl:h-16"
			/>
		</a>

		<nav class="hidden lg:block">
			<ul
				class="flex items-center gap-4 xl:gap-8 font-medium lg:font-medium xl:font-semibold text-base lg:text-base xl:text-lg 2xl:text-xl"
			>
				<li class="relative group">
					<a
						href="/about"
						class:list={[
							"cursor-pointer flex items-center gap-1 hover:text-gray-200 py-2",
							isActive('/about') && "text-crema"
						]}
					>
						Quienes somos
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="16"
							height="16"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							class="w-4 h-4"><path d="m6 9 6 6 6-6"></path></svg
						>
					</a>
					<!-- Dropdown -->
					<div
						class="absolute top-full left-0 mt-0 w-48 lg:w-56 xl:w-80 bg-verde-claro-2/50 text-white shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 overflow-hidden"
					>
						<ul class="flex flex-col">
							<li>
								<a
									href="/about#fundadores"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Fundadores</a
								>
							</li>
							<li>
								<a
									href="/about#mision"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Misión</a
								>
							</li>
							<li>
								<a
									href="/about#vision"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Visión</a
								>
							</li>
							<li>
								<a
									href="/about#valores"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Valores</a
								>
							</li>
							<li>
								<a
									href="/about#proposito"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Propósito</a
								>
							</li>
						</ul>
					</div>
				</li>
				<li>
					<a 
						href="/canton-fair" 
						class:list={[
							"cursor-pointer hover:text-gray-200 transition-colors",
							isActive('/canton-fair') && "text-crema"
						]}
					>Feria de Cantón</a>
				</li>
				<li class="relative group">
					<a
						href="/services"
						class:list={[
							"cursor-pointer flex items-center gap-1 hover:text-gray-200 py-2",
							isActive('/services') && "text-crema"
						]}
					>
						Servicios
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="16"
							height="16"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							class="w-4 h-4"><path d="m6 9 6 6 6-6"></path></svg
						>
					</a>
					<!-- Dropdown -->
					<div
						class="absolute top-full left-0 mt-0 w-48 lg:w-56 xl:w-96 bg-verde-claro-2/50 text-white shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 overflow-hidden"
					>
						<ul class="flex flex-col">
							<li>
								<a
									href="/services#documentation"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Gestión Documental</a
								>
							</li>
							<li>
								<a
									href="/services#logistics"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Logística Internacional</a
								>
							</li>
							<li>
								<a
									href="/services#consultancy"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Consultoría en Comercio Internacional</a
								>
							</li>
							<li>
								<a
									href="/services#incoterms"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Gestión de Incoterms</a
								>
							</li>
							<li>
								<a
									href="/services#export"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Servicios de Exportación</a
								>
							</li>
							<li>
								<a
									href="/services#import"
									class="block px-4 py-3 hover:bg-verde-deg-1 border border-white/30"
									>Servicios de Importación</a
								>
							</li>
						</ul>
					</div>
				</li>
				<li>
					<a 
						href="/contact" 
						class:list={[
							"cursor-pointer hover:text-gray-200 transition-colors",
							isActive('/contact') && "text-crema"
						]}
					>Contacto</a>
				</li>
				<li>
					<a 
						href="/partners" 
						class:list={[
							"cursor-pointer hover:text-gray-200 transition-colors",
							isActive('/partners') && "text-crema"
						]}
					>Partners estratégicos</a>
				</li>
			</ul>
		</nav>

		<!-- Mobile Menu Button -->
		<button id="mobile-menu-btn" class="lg:hidden text-white z-50">
			<!-- Hamburger Icon -->
			<svg
				id="hamburger-icon"
				xmlns="http://www.w3.org/2000/svg"
				fill="none"
				viewBox="0 0 24 24"
				stroke-width="1.5"
				stroke="currentColor"
				class="w-8 h-8"
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path>
			</svg>
			<!-- Close Icon -->
			<svg
				id="close-icon"
				xmlns="http://www.w3.org/2000/svg"
				fill="none"
				viewBox="0 0 24 24"
				stroke-width="1.5"
				stroke="currentColor"
				class="w-8 h-8 hidden"
			>
				<path
					stroke-linecap="round"
					stroke-linejoin="round"
					d="M6 18L18 6M6 6l12 12"></path>
			</svg>
		</button>
	</section>

	<!-- Mobile Menu -->
	<nav id="mobile-menu" class="lg:hidden fixed inset-0 top-[88px] bg-linear-to-b from-verde-deg-black/90 to-verde-deg-2/90 transform translate-x-full transition-transform duration-300 ease-in-out z-40 overflow-y-auto">
		<ul class="flex flex-col text-white font-medium text-lg">
			<!-- Quienes somos con submenu -->
			<li class="border-b border-white/20">
				<div class="flex items-center justify-between">
					<a
						href="/about"
						class:list={[
							"mobile-link flex-1 px-6 py-4 hover:bg-verde-claro-2 transition-colors",
							isActive('/about') && "text-crema"
						]}
					>
						Quienes somos
					</a>
					<button class="submenu-toggle px-6 py-4 hover:bg-verde-claro-2 transition-colors" data-target="about-submenu">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							class="submenu-icon transition-transform duration-300"
						><path d="m6 9 6 6 6-6"></path></svg>
					</button>
				</div>
				<ul id="about-submenu" class="submenu bg-verde-claro-2/50 max-h-0 overflow-hidden transition-all duration-300">
					<li><a href="/about#fundadores" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Fundadores</a></li>
					<li><a href="/about#mision" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Misión</a></li>
					<li><a href="/about#vision" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Visión</a></li>
					<li><a href="/about#valores" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Valores</a></li>
					<li><a href="/about#proposito" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Propósito</a></li>
				</ul>
			</li>

			<!-- Feria de Cantón -->
			<li class="border-b border-white/20">
				<a
					href="/canton-fair"
					class:list={[
						"mobile-link block px-6 py-4 hover:bg-verde-claro-2 transition-colors",
						isActive('/canton-fair') && "text-crema"
					]}
				>
					Feria de Cantón
				</a>
			</li>

			<!-- Servicios con submenu -->
			<li class="border-b border-white/20">
				<div class="flex items-center justify-between">
					<a
						href="/services"
						class:list={[
							"mobile-link flex-1 px-6 py-4 hover:bg-verde-claro-2 transition-colors",
							isActive('/services') && "text-crema"
						]}
					>
						Servicios
					</a>
					<button class="submenu-toggle px-6 py-4 hover:bg-verde-claro-2 transition-colors" data-target="services-submenu">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="20"
							height="20"
							viewBox="0 0 24 24"
							fill="none"
							stroke="currentColor"
							stroke-width="2"
							stroke-linecap="round"
							stroke-linejoin="round"
							class="submenu-icon transition-transform duration-300"
						><path d="m6 9 6 6 6-6"></path></svg>
					</button>
				</div>
				<ul id="services-submenu" class="submenu bg-verde-claro-2/50 max-h-0 overflow-hidden transition-all duration-300">
					<li><a href="/services#documentation" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Gestión Documental</a></li>
					<li><a href="/services#logistics" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Logística Internacional</a></li>
					<li><a href="/services#consultancy" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Consultoría en Comercio Internacional</a></li>
					<li><a href="/services#incoterms" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Gestión de Incoterms</a></li>
					<li><a href="/services#export" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Servicios de Exportación</a></li>
					<li><a href="/services#import" class="mobile-link block px-10 py-3 hover:bg-verde-deg-1 transition-colors">Servicios de Importación</a></li>
				</ul>
			</li>

			<!-- Contacto -->
			<li class="border-b border-white/20">
				<a
					href="/contact"
					class:list={[
						"mobile-link block px-6 py-4 hover:bg-verde-claro-2 transition-colors",
						isActive('/contact') && "text-crema"
					]}
				>
					Contacto
				</a>
			</li>

			<!-- Partners estratégicos -->
			<li class="border-b border-white/20">
				<a
					href="/partners"
					class:list={[
						"mobile-link block px-6 py-4 hover:bg-verde-claro-2 transition-colors",
						isActive('/partners') && "text-crema"
					]}
				>
					Partners estratégicos
				</a>
			</li>
		</ul>
	</nav>
</header>

<script>
	const header = document.getElementById('main-header');
	const mobileMenuBtn = document.getElementById('mobile-menu-btn');
	const mobileMenu = document.getElementById('mobile-menu');
	const hamburgerIcon = document.getElementById('hamburger-icon');
	const closeIcon = document.getElementById('close-icon');
	const submenuToggles = document.querySelectorAll('.submenu-toggle');
	const mobileLinks = document.querySelectorAll('.mobile-link');

	let isMenuOpen = false;

	const handleScroll = () => {
		if (window.scrollY > 50 || isMenuOpen) {
			header?.classList.add('bg-linear-to-r', 'from-verde-deg-black/80', 'to-verde-deg-2/80');
		} else {
			header?.classList.remove('bg-linear-to-r', 'from-verde-deg-black/80', 'to-verde-deg-2/80');
		}
	};

	const toggleMenu = () => {
		isMenuOpen = !isMenuOpen;
		
		if (isMenuOpen) {
			mobileMenu?.classList.remove('translate-x-full');
			mobileMenu?.classList.add('translate-x-0');
			hamburgerIcon?.classList.add('hidden');
			closeIcon?.classList.remove('hidden');
			document.body.style.overflow = 'hidden';
		} else {
			mobileMenu?.classList.add('translate-x-full');
			mobileMenu?.classList.remove('translate-x-0');
			hamburgerIcon?.classList.remove('hidden');
			closeIcon?.classList.add('hidden');
			document.body.style.overflow = '';
		}
		
		handleScroll();
	};

	const closeMenu = () => {
		if (isMenuOpen) {
			toggleMenu();
		}
	};

	// Toggle menu on button click
	mobileMenuBtn?.addEventListener('click', toggleMenu);

	// Close menu when clicking on a link
	mobileLinks.forEach(link => {
		link.addEventListener('click', closeMenu);
	});

	// Submenu toggles
	submenuToggles.forEach(toggle => {
		toggle.addEventListener('click', (e) => {
			e.stopPropagation();
			const targetId = toggle.getAttribute('data-target');
			const submenu = document.getElementById(targetId || '');
			const icon = toggle.querySelector('.submenu-icon');
			
			if (submenu) {
				const isOpen = submenu.classList.contains('max-h-96');
				
				if (isOpen) {
					submenu.classList.remove('max-h-96');
					submenu.classList.add('max-h-0');
					icon?.classList.remove('rotate-180');
				} else {
					submenu.classList.add('max-h-96');
					submenu.classList.remove('max-h-0');
					icon?.classList.add('rotate-180');
				}
			}
		});
	});

	// Close menu when clicking outside
	document.addEventListener('click', (e) => {
		const target = e.target as HTMLElement;
		
		if (isMenuOpen && 
			!mobileMenu?.contains(target) && 
			!mobileMenuBtn?.contains(target)) {
			closeMenu();
		}
	});

	// Ejecutar al cargar
	handleScroll();
	
	// Ejecutar al hacer scroll
	window.addEventListener('scroll', handleScroll);
</script>
